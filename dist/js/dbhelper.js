"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}var DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"createDb",value:function(){return idb.open("restaurantDb",1,function(t){t.objectStoreNames.contains("restaurants")||t.createObjectStore("restaurants",{keyPath:"name"})})}},{key:"restaurantDb",value:function(r){n.createDb().then(function(t){var e=t.transaction("restaurants","readwrite"),n=e.objectStore("restaurants");return document.URL.startsWith("https://dragosbus")?r.restaurants.forEach(function(t){return n.put(t)}):r.forEach(function(t){return n.put(t)}),e.complete}).then(function(){return console.log("Restaurants added to db")})}},{key:"fetchData",value:function(){return fetch(n.DATABASE_URL).then(function(t){return t.json()}).then(function(t){return t}).then(n.restaurantDb).catch(function(t){return console.log("Failed to fetch data")})}},{key:"fetchRestaurants",value:function(e){n.fetchData(),n.createDb().then(function(t){return t.transaction("restaurants").objectStore("restaurants").getAll()}).then(function(t){t?e(null,t):e(error,null)})}},{key:"fetchRestaurantById",value:function(r,a){n.fetchRestaurants(function(t,e){if(t)a(t,null);else{var n=e.find(function(t){return t.id==r});n?a(null,n):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){n.fetchRestaurants(function(t,e){if(t)a(t,null);else{var n=e.filter(function(t){return t.cuisine_type==r});a(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){n.fetchRestaurants(function(t,e){if(t)a(t,null);else{var n=e.filter(function(t){return t.neighborhood==r});a(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,u){n.fetchRestaurants(function(t,e){if(t)u(t,null);else{var n=e;"all"!=r&&(n=n.filter(function(t){return t.cuisine_type==r})),"all"!=a&&(n=n.filter(function(t){return t.neighborhood==a})),u(null,n)}})}},{key:"fetchNeighborhoods",value:function(a){n.fetchRestaurants(function(t,n){if(t)a(t,null);else{var r=n.map(function(t,e){return n[e].neighborhood}),e=r.filter(function(t,e){return r.indexOf(t)==e});a(null,e)}})}},{key:"fetchCuisines",value:function(a){n.fetchRestaurants(function(t,n){if(t)a(t,null);else{var r=n.map(function(t,e){return n[e].cuisine_type}),e=r.filter(function(t,e){return r.indexOf(t)==e});a(null,e)}})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id=".concat(t.id)}},{key:"imageUrlForRestaurant",value:function(t){return document.URL.startsWith("https://dragosbus")?"dist/img/".concat(t.photograph):t.photograph?"dist/img/".concat(t.photograph,".jpg"):"dist/img/".concat(t.id,".jpg")}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:n.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){if(document.URL.startsWith("https://dragosbus"))return"https://dragosbus.github.io/restaurant_review/data/restaurants.json";return"http://localhost:".concat(1337,"/restaurants")}}]),n}();