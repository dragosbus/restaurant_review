"use strict";var restaurant,map,fetchRestaurantFromURL,fillRestaurantHTML,fillRestaurantHoursHTML,fillReviewsHTML,createReviewHTML,fillBreadcrumb,getParameterByName,styling;function createDB(){return idb.open("reviewsDb",1,function(e){e.objectStoreNames.contains("reviews")||e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0})})}window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),n(null,t)):console.error(e)}):(error="No restaurant id in URL",n(error,null))}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.setAttribute("alt","".concat(e.name," Photo")),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}};var addReviewContainer=function(){var e=document.createElement("div"),t=document.createElement("textarea"),n=document.createElement("button");return e.className="review-container",t.className="review-text",n.className="review-add",n.textContent="Comment",e.appendChild(t),e.appendChild(n),e};fillReviewsHTML=function(e){var t=window.location.href,n=Number.isNaN(+t.slice(-2))?t.slice(-1):t.slice(-2),r=document.getElementById("reviews-list");createDB().then(function(e){return e.transaction("reviews").objectStore("reviews").getAll()}).then(function(e){return e.filter(function(e){return e.idRestaurant===n})}).then(function(e){e.length&&e.map(function(e){var t=document.createElement("li"),n="<h4>From ".concat(e.name,"</h4>\n        <p>Rating: ").concat(e.rating,"</p>\n        <p>").concat(e.comment,"</p>");t.innerHTML=n,r.appendChild(t)})})},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var r=document.createElement("p");r.innerHTML=e.date,t.appendChild(r);var a=document.createElement("p");a.innerHTML="Rating: ".concat(e.rating),t.appendChild(a);var i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]".concat(e,"(=([^&#]*)|&|#|$)")).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},document.querySelector(".review-form").addEventListener("submit",function(e){UI.addReview(e).then(function(e){var t=createDB();UI.updateReviewsDB(t,e),UI.appendReview(t)})});